---
import Layout from "../../layouts/Layout.astro";
import Section from "../../components/Section.astro";
import ToggleLang from "../parts/ToggleLang.astro";
import TimeTable from "../parts/TimeTable.astro";
import Table from "../parts/Table.astro";
import Modal from "../parts/Modal.astro";

interface Props {
  data: {
    pageTitle: string;
    h2_1: string;
    sections: {
      title: string;
      list: {
        name: string;
        modal: boolean;
      }[];
    }[];
    h2_2: string;
    h2_3: string;
    ateendee: {
      thead: string[];
      tbody: {
        item1: string;
        item2: string;
        item3: string;
      }[];
    };
  };
  lang: string;
}

const { data, lang } = Astro.props as Props;

---

<Layout pageTitle={data.pageTitle} lang={lang}>
  <Section title={data.h2_1}>
    {
      data.sections.map((section) => (
        <Section title={section.title} h3 lang={lang}>
          <ul class="list">
            {section.list.map((item) => {
              return (
                <li class={item.modal ? "hasModal" : ""}>{item.name}</li>
              );
            })}
          </ul>
        </Section>

        <Modal data={[{ imgSrc: "", name: "", detail: "" }]} />
      ))
    }
  </Section>
  <Section title={data.h2_2}>
    <TimeTable />
  </Section>
  <Section title={data.h2_3}>
    <Table thead={data.ateendee.thead} tbody={data.ateendee.tbody} />
  </Section>
  <ToggleLang lang={lang} />
  <Modal data={[{ imgSrc: "", name: "", detail: "" }]} />
</Layout>

<style lang="scss">
  @import "../../styles/mq.scss";

  // hasModalクラスを持つ要素はモーダルアイコンを表示
  .hasModal {
    position: relative;
    width: fit-content;
    
    &::after {
      content: "";
      display: block;
      position: absolute;
      top: 50%;
      right: -15px;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: url("../../images/program/icon-information.png") no-repeat;
      background-size: contain;
    }
  }
</style>

<script>
  const modalOpenElements = document.querySelectorAll("hasModal");
  const modal = document.querySelector("modal");
  const modalImg = document.getElementById("modalImg") as HTMLImageElement;
  const modalName = document.getElementById("modalName") as HTMLDivElement;
  const modalDetail = document.getElementById("modalDetail") as HTMLDivElement;

  modalOpenElements.forEach((element) => {
    element.addEventListener("click", (event: any) => {
      const target = event.currentTarget;
      if (modal != null && modalImg != null && modalName != null && modalDetail != null) {
        modal.classList.add("-active");
        modalImg.src = target.dataset.imgSrc;
        modalName.textContent = target.dataset.name;
        modalDetail.textContent = target.dataset.detail;
      }
    });
  });
</script>